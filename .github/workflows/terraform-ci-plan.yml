name: Homelab CI/CD Workflow
run-name: "Terraform Plan (CI) - ${{ github.ref_name }}" 
on:
  pull_request:
    types: [opened, reopened, synchronize]  
    paths-ignore:
      - '**/*.md'
      - '.github/workflows/**'
  workflow_dispatch:

jobs:
  detect-terraform-directory:
    runs-on: ubuntu-latest
    steps:
      - name: Find Terraform directory
        id: find_tf
        run: |
          TF_DIR=$(find . -type f -name "*.tf" -exec dirname {} \; | sort -u | head -n 1)
          echo "TF_DIR=$TF_DIR" >> $GITHUB_ENV
          echo "dir=$TF_DIR" >> $GITHUB_OUTPUT

